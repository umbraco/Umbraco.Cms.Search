# The Examine search provider

Umbraco Search uses a provider based approach to the underlying search technology. By default, Umbraco Search is powered by [Examine](https://github.com/Shazwazza/Examine), which likely will require a bit of configuration to function as intended.

> [!NOTE]
> This section _only_ applies to the default Examine search provider. Alternative search providers might be available, and they might require a different configuration.

## Directory factory configuration

The Examine search provider automatically applies the [Examine directory configuration](https://docs.umbraco.com/umbraco-cms/reference/configuration/examinesettings) from Umbraco CMS.

## Configuring fields for faceting and/or sorting

Fields that will be used for faceting and/or sorting must be explicitly configured for the Examine search provider, _before_ anything is added to the indexes. This is done by configuring the `FieldOptions` using the options pattern.

The field configuration is essentially a mapping between the Umbraco property aliases that hold the values, and the expected field index type of those properties. For example, the "genre" and "releaseYear" fields used throughout this article should be configured like this:

```csharp
using Umbraco.Cms.Core.Composing;
using Umbraco.Cms.Search.Provider.Examine.Configuration;

namespace Site.DependencyInjection;

public class FieldOptionsComposer : IComposer
{
    public void Compose(IUmbracoBuilder builder)
        => builder.Services.Configure<FieldOptions>(options
            => options.Fields =
            [
                // configure faceting and sorting for the "genre" property
                new FieldOptions.Field
                {
                    PropertyName = "genre",
                    FieldValues = FieldValues.Keywords,
                    Facetable = true,
                    Sortable = true
                },
                // configure faceting and sorting for the "releaseYear" property
                new FieldOptions.Field
                {
                    PropertyName = "releaseYear",
                    FieldValues = FieldValues.Integers,
                    Facetable = true,
                    Sortable = true
                }
            ]
        );
}
```
> [!IMPORTANT]
> Since the field configurations must be known at index time, any changes made to this configuration will only take effect after a rebuild of all indexes.

## Configuring the search behavior

The `SearcherOptions` allow for configuring various aspects of how a search is executed. It is configured using the options pattern:

```csharp
using Umbraco.Cms.Core.Composing;
using Umbraco.Cms.Search.Provider.Examine.Configuration;

namespace Site.DependencyInjection;

public class SearcherOptionsComposer : IComposer
{
    public void Compose(IUmbracoBuilder builder)
        => builder.Services.Configure<SearcherOptions>(options =>
        {
            // configure searcher options here
        });
}
```

### Boost levels

Certain Umbraco properties yield different textual relevance values (see [Appendix A](searching.md#appendix-a-indexed-values-of-built-in-property-editors)). The Examine search provider automatically performs relevance boosting accordingly, but the boost levels can be tweaked if required. Use:

- `SearcherOptions.BoostFactorTextR1` to control the relevance of highest relevance text (e.g. document names and H1 tags).
- `SearcherOptions.BoostFactorTextR2` to control the relevance of second-highest relevance text (e.g. H2 tags).
- `SearcherOptions.BoostFactorTextR3` to control the relevance of third-highest relevance text (e.g. H3 tags).

### Facet result behavior

The available facet values are grouped by the `FieldName` passed to the facet definition when searching. In the examples above, this would be "genre" and "releaseYear".

When an end user picks a facet value from a search result, the subsequent search should contain a filter for the picked value - for example, the `KeywordFilter` in the examples above.

If a facet value has been picked and is applied as a filter, the default behavior for facet results is to exclude the facet values that are _not_ picked within the facet group.

If all (applicable) facet values should be included for all groups in the search result, configure `SearcherOptions.ExpandFacetValues` as `true`.

> [!CAUTION]
> Expanding the facet values incurs a performance penalty, which is more or less linear to the number of facet groups in the search.

### Max facet values

The Examine search provider limits the number of resulting facet values within a facet group to 100. This limit can be changed using `SearcherOptions.MaxFacetValues`.
